<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyAid – E-Book Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
.container{
  max-width:600px;
  background:#fff;
  padding:20px;
  margin:auto;
  border-radius:8px;
}
h2{text-align:center}
label{display:block;margin-top:12px;font-weight:bold}
input,textarea,select,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:5px;
  border:1px solid #ccc;
}
textarea{resize:vertical}
.preview{
  background:#f0f0f0;
  padding:15px;
  margin-top:20px;
  border-radius:6px;
}
.price{font-size:18px;font-weight:bold}
button{
  background:#0a7cff;
  color:#fff;
  border:none;
  cursor:pointer;
  margin-top:15px;
  font-weight:bold;
}
.back-btn{
  background:#ddd;
  color:#000;
  margin-bottom:15px;
}
</style>
</head>
<body>

<div class="container">
<button class="back-btn" onclick="window.history.back()">←</button>

<h2>E-Book Order</h2>
<p><strong>Order ID:</strong> <span id="orderId"></span></p>

<label>Purchase Item</label>
<select id="purchase" onchange="updatePreview()">
  <option>E-Books</option>
  <option>Other</option>
</select>

<label>Email Address</label>
<input type="email" id="email" required>

<label>WhatsApp Number</label>
<input type="text" id="whatsapp" placeholder="080..." required>

<label>Delivery Speed</label>
<select id="urgency" onchange="updatePreview()">
  <option value="normal">Normal (10–20 mins)</option>
  <option value="urgent">Urgent (5 mins)</option>
</select>

<div class="preview">
<h3>Order Preview</h3>
<p><strong>Item:</strong> <span id="pItem">—</span></p>
<p><strong>Delivery:</strong> <span id="pDelivery">—</span></p>
<p class="price">Total: ₦<span id="pPrice">0</span></p>
</div>

<button onclick="proceedToPayment()">Proceed to Payment</button>
</div>

<script>
// Generate unique order ID
const orderId =
"SA-" + new Date().toISOString().slice(0,10).replace(/-/g,"") + "-" + Math.floor(Math.random()*9000+1000);
document.getElementById("orderId").innerText = orderId;

// Read URL parameter for pre-selected book
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

// Preselect book if passed from ebooks.html
const preSelectedBook = getQueryParam("book");
const purchaseSelect = document.getElementById("purchase");
if(preSelectedBook){
  let optionExists = false;
  for(let i=0;i<purchaseSelect.options.length;i++){
    if(purchaseSelect.options[i].value === preSelectedBook){
      purchaseSelect.selectedIndex = i;
      optionExists = true;
      break;
    }
  }
  if(!optionExists){
    // If the book isn't in the dropdown, select "Other"
    for(let i=0;i<purchaseSelect.options.length;i++){
      if(purchaseSelect.options[i].value==="Other"){
        purchaseSelect.selectedIndex = i;
        break;
      }
    }
  }
}

// Update preview info
function updatePreview(){
  const item = preSelectedBook || purchaseSelect.value;
  const urgency = document.getElementById("urgency").value;

  let price = 500;
  let delivery = "10–20 mins";
  if(urgency==="urgent"){ price = 800; delivery="5 mins"; }

  document.getElementById("pItem").innerText = item;
  document.getElementById("pDelivery").innerText = delivery;
  document.getElementById("pPrice").innerText = price;
}
updatePreview();

// Button: proceed to payment
function proceedToPayment(){
  const email = document.getElementById("email").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const item = document.getElementById("pItem").innerText;
  const delivery = document.getElementById("pDelivery").innerText;
  const total = document.getElementById("pPrice").innerText;

  if(!item || item==="—" || !email || !whatsapp){
    alert("Please complete all required fields!");
    return;
  }

  const url = `payment.html?orderID=${encodeURIComponent(orderId)}&item=${encodeURIComponent(item)}&email=${encodeURIComponent(email)}&whatsapp=${encodeURIComponent(whatsapp)}&delivery=${encodeURIComponent(delivery)}&total=${encodeURIComponent(total)}`;
  window.location.href = url;
}
</script>

</body>
</html>
